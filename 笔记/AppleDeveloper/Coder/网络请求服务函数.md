# 网络请求服务函数的几点注意

这里说的并不是说对网络请求服务进行封装。只是在调用接口时的几个点。

例如有下面这个调用

```Objective-c
-(void)fetchDataWithSuccessBlock:(void(^)(void))successBlock
                       failBlock:(void(^)(void))failBlock {
    if(xxx) {
        return;//--1--这里就是坑
    }
    NSDictionary * params = @{@"xxx":@"xxx"};
    AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];
    [manager GET:@"http://example.com/resources.json" parameters:params progress:nil success:^(NSURLSessionTask *task, id responseObject) {
        NSLog(@"JSON: %@", responseObject);
    } failure:^(NSURLSessionTask *operation, NSError *error) {
        NSLog(@"Error: %@", error);
    }];
}
```

#### 问题一：`params` 是放在里面呢，还是外面呢？

好像是都可以的啊。但后期维护还是有点细微差别的。

1.  当这个服务会在多个地方调用，而且`params`的创建在外面，那每次都得多写几行代码。当然，复制一下也不是啥问题。但如果有点需要改其它一个参数呢？那不就所有用到的地方都得改了？

2. 所以那放里面好了。但，放里面的话，问题又来了。如果有一天，这个服务有个参数需要根据调用场景的不同而变化的呢？

#### 问题二：不应该直接`return`

`1`处的代码，直接return了。这就是挖坑了。自从有了`block`后，这类函数也少有说需要返回值的。我们在开发使用中也少有说会根据函数同步返回值去处理。一般都是走`block`的。所以函数的形式给使用都一种直接感受是，这个函数的`block`两个一定会走一个。所以，异常和成功都有处理。但如果函数内把回调吞了，这就坑了，相当于你走进异常，但是不给回调？万一使用者在外面有个全局`loading`呢？
